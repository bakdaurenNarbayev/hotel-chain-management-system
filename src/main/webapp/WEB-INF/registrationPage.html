<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Authorization</title>
<script src="https://code.jquery.com/jquery-3.4.1.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<script>
function authorization() {
		$.post('http://localhost:8080/HotelChainManagementSystem/services/authorization', {username: $("#username").val(), password: $("#password").val()}, function(r) {
			if(r == null) {
				document.getElementById("warning").innerHTML = "Incorrect login and/or password. Please try again!";
			}
			else {
				 window.location.href = r;
			}
		})
}

function registration() {
	var userData = {
		"full_name"	:	$("#firstname").val() + " " + $("#lastname").val(),
		"id_type"	:	$("input[name='idtype']:checked").val(),
		"id_number"	:	$("#idnumber").val(),
		"category"	:	$("input[name='category']:checked").val(),
		"address"	:	$("#address").val(),
		"home_phone_number"	:	$("#homephonenumber").val(),
		"mobile_phone_number"	:	$("#mobilephonenumber").val(),
	};
	$.post('http://localhost:8080/HotelChainManagementSystem/services/registration', {username: $("#username").val(), password: $("#password").val()}, function(r) {
		if(r == "UserAlreadyExists") 
			document.getElementById("warning").innerHTML = "Such username already exists";
		else if (r == "invalidInput") {
			document.getElementById("warning").innerHTML = "Incorrect login and/or password. Please try again!";
		}
		else {
			authorization();
		}
	})
	var regexp = /^[a-zA-Z0-9_-]{4,12}$/;
	var passwordRegexp = /{4,}/
	var usernameIsValid = regexp.test($("#username").val());
	var passwordIsValid = passwordRegexp.test($("#password").val());
	if (usernameIsValid && passwordIsValid) {
		$.post('http://localhost:8080/HotelChainManagementSystem/services/registration', {username: $("#username").val(), password: $("#password").val()}, function(r) {
			if(r == "UserAlreadyExists") 
				document.getElementById("warning").innerHTML = "Such username already exists";
			else if (r == "invalidInput") 
				document.getElementById("warning").innerHTML = "Incorrect login and/or password. Please try again!";
			else {
				authorization();
			}
		})
	} else {
		document.getElementById("warning").innerHTML = "Username or Passowrd does not match the requirements";
	}
}

$(document).ready(function() {
	$('#Register').on("click", function() {
		registration();
	});
})

</script>	
</head>
<body>
<h2>
<a href="http://localhost:8080/HotelChainManagementSystem/">Hotel Chain Management System</a>
</h2>
<h3>Please, fill in the following forms to register</h3>
	Username: <input type="text" id="username" name="username"><br><br>
	First Name: <input type="text" id="firstname" name="firstname"><br><br>
	Last Name: <input type="text" id="lastname" name="lastname"><br><br>
	Identification Type: &nbsp;
		<input type="radio" id="passport" name="idtype" value="passport">
		<label for="passport">Passport</label>&nbsp;
		<input type="radio" id="id" name="idtype" value="nationalid">
		<label for="id">National ID</label><br><br>
	Identification Number:
		<input type="text" id="idnumber" name="idnumber"><br><br>
	Category: &nbsp;
		<input type="radio" id="veteran" name="category" value="veteran">
		<label for="veteran">Veteran</label>&nbsp;
		<input type="radio" id="disabled" name="category" value="disabled">
		<label for="disabled">Disabled</label><br><br>
	Address:
		<input type="text" id="address" name="address"><br><br>
	Home phone number:
		<input type="text" id="homephonenumber" name="homephonenumber"><br><br>
	Mobile phone number:
		<input type="text" id="mobilephonenumber" name="mobilephonenumber"><br><br>
	Password: <input type="password" id="password" name="password"><br><br>
	<h4 id="warning" style="color:red"></h4>
	Confirm password: <input type="password" id="password2" name="password2"><br><br>
	<button id="Register" type="button">Register</button>
</body>
</html>

