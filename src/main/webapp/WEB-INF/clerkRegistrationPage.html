<!DOCTYPE html>
<html>
<head>
<meta charset="ISO-8859-1">
<title>Clerk Registration</title>
<script src="https://code.jquery.com/jquery-3.4.1.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<script>

var hotels, hotelIDs;
function registration() {
	var hotelName = document.querySelector("select").value;
	var index = hotels.indexOf(hotelName);
	var hotelID = hotelIDs[index];
	var date = new Date($('#birthday').val());
	var month = date.getMonth() + 1;
	var startDate = new Date($('#start-date').val());
	var startMonth = startDate.getMonth() + 1;
	
	var endDate = new Date($('#end-date').val());
	var endMonth = endDate.getMonth() + 1;
	
	if(isNaN(endDate)) {
		endDate = "NULL";
	} else {
		endDate = endDate.getFullYear().toString() + "-" +  endMonth.toString()  + "-" +  endDate.getDate().toString();
	}
	
	var userData = {
		"position"	:	"desk-clerk",
		"fullName"	:	$("#firstname").val() + " " + $("#lastname").val(),
		"gender"	:	$("input[name='gender']:checked").val(),
		"dateOfBirth"	:	date.getFullYear().toString() + "-" +  month.toString()  + "-" +  date.getDate().toString(),
		"identificationType"	:	$("input[name='idtype']:checked").val(),
		"identificationNumber"	:	$("#idnumber").val(),
		"citizenship"	:	$("#citizenship").val(),
		"visa"	:	$("#visa").val(),
		"address"	:	$("#address").val(),
		"bankCardNumber"	:	$("#bankcardnumber").val(),
		"emailAddress"	:	$("#email").val(),
		"homePhoneNumber"	:	$("#homephonenumber").val(),
		"mobilePhoneNumber"	:	$("#mobilephonenumber").val(),
		"hotelID"  :  hotelID,
		"status"  :  $("input[name='status']:checked").val(),
		"startDate"  :  startDate.getFullYear().toString() + "-" +  startMonth.toString()  + "-" +  startDate.getDate().toString(),
		"endDate"  :  endDate,
		"payRate"  :  $("#payRate").val(),
		"login"  :  $("#username").val(),
		"password"  :  $("#password").val(),
	};
	var userDataJSON = JSON.stringify(userData);
	var regexp = /^[a-zA-Z0-9_-]{4,12}$/;
	var usernameIsValid = regexp.test($("#username").val());
	var emailRegex = /\S+@\S+\.\S+/;
	var emailIsValid = emailRegex.test($("#email").val());
	if (usernameIsValid && emailIsValid) {
		//TODO for Madik:
		$.post('http://localhost:8080/HotelChainManagementSystem/services/employee-registration/user-data', {employeeInJson : userDataJSON}, function(r) {
			if(r == "UserAlreadyExists") 
				document.getElementById("warning").innerHTML = "Such username already exists";
			else if (r == "invalidInput") 
				document.getElementById("warning").innerHTML = "Incorrect login and/or password. Please try again!";
			else {
				document.getElementById("warning").innerHTML = "";
				document.getElementById("confirmation").innerHTML = "Employee was registered successfully!";
			}
		})
		//END of TODO
	} else {
		document.getElementById("warning").innerHTML = "Username or Email does not match the requirements";
	}
}

function getHotels() {
	queryParam = window.location.href.substring(85);
	$.ajax({
        url : 'http://localhost:8080/HotelChainManagementSystem/services/employee-registration/hotels?auth=' + queryParam,
        dataType : 'json',
        success : function(r) {
            hotels = r.hotels;
            hotelIDs = r.hotelIDs;
            
            $('#container')
            .append(
              $(document.createElement('label')).prop({
                for: 'hotels'
              }).html('Choose Hotel: ')
            )
            .append(
              $(document.createElement('select')).prop({
                id: 'hotels',
                name: 'hotels'
              })
            )

          var index = 0;
          for (const val of r.hotels) {
            $('#hotels').append($(document.createElement('option')).prop({
              value: val,
              text: val.charAt(0).toUpperCase() + val.slice(1),
              id: hotelIDs[index]
            }))
          }
          index = index + 1;
        }
    });
}

$(document).ready(function() {
	$('#Register').on("click", function() {
		registration();
	});
	
	getHotels();
})

</script>
</head>
<body>
<h2>
<a href="http://localhost:8080/HotelChainManagementSystem/">Hotel Chain Management System</a>
</h2>
<h3>Please, fill in the following forms to register</h3>
	Username: <input type="text" id="username" name="username"><br><br>
	First Name: <input type="text" id="firstname" name="firstname"><br><br>
	Last Name: <input type="text" id="lastname" name="lastname"><br><br>
	Gender: &nbsp;
		<input type="radio" id="male" name="gender" value="male">
		<label for="gender">Male</label>&nbsp;
		<input type="radio" id="female" name="gender" value="female">
		<label for="gender">Female</label><br><br>
	Date of Birth: 
		<input type="date" id="birthday" name="birthday" max="2005-01-01"><br><br>
	Identification Type: &nbsp;
		<input type="radio" id="passport" name="idtype" value="passport">
		<label for="passport">Passport</label>&nbsp;
		<input type="radio" id="id" name="idtype" value="nationalid">
		<label for="id">National ID</label>&nbsp;
		<input type="radio" id="ssn" name="idtype" value="ssn">
		<label for="id">Social Security Number</label>&nbsp;
		<input type="radio" id="iin" name="idtype" value="iin">
		<label for="id">Individual Indentification Number</label><br><br>
	Identification Number:
		<input type="text" id="idnumber" name="idnumber"><br><br>
	Citizenship:
		<input type="text" id="citizenship" name="citizenship"><br><br>
	VISA:
		<input type="text" id="visa" name="visa"><br><br>
	Address:
		<input type="text" id="address" name="address"><br><br>
	Bank Card Number:
		<input type="text" id="bankcardnumber" name="bankcardnumber"><br><br>
	Email:
		<input type="text" id="email" name="email"><br><br>
	Home phone number:
		<input type="text" id="homephonenumber" name="homephonenumber"><br><br>
	Mobile phone number:
		<input type="text" id="mobilephonenumber" name="mobilephonenumber"><br><br>
	<div id="container"></div><br>
	Status: &nbsp;
		<input type="radio" id="full-time" name="status" value="full-time">
		<label for="passport">Full-time</label>&nbsp;
		<input type="radio" id="part-time" name="status" value="part-time">
		<label for="id">Part-time</label>&nbsp;
		<input type="radio" id="intern" name="status" value="intern">
		<label for="id">Intern</label>&nbsp;
		<input type="radio" id="visiting" name="status" value="visiting">
		<label for="id">Visiting</label><br><br>
	Start Date: 
		<input type="date" id="start-date" name="start-date" max="2005-01-01"><br><br>
	End Date:
		<input type="date" id="end-date" name="end-date" max="2005-01-01"><br><br>
	Pay rate:
		<input type="text" id="payRate" name="payRate"><br><br>
	Password: <input type="password" id="password" name="password"><br><br>
	Confirm password: <input type="password" id="password2" name="password2"><br><br>
	<h4 id="warning" style="display: inline;color:red;"></h4>
	<h4 id="confirmation" style="color:green;"></h4>
	<button id="Register" type="button">Register</button>
</body>
</html>